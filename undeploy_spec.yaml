version: 0.1 
component: build
timeoutInSeconds: 100
shell: bash

steps:
  - type: Command
    name: 'Download Kubectl'
    command: |
      curl -LO "https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl"
      chmod +x kubectl
      mkdir -p ~/.local/bin
      mv ./kubectl ~/.local/bin/kubectl
      export PATH=$PATH:~/.local/bin

  - type: Command
    name: 'Configure Kubeconfig'
    command: |
      export OCI_CLI_AUTH=instance_principal
      oci ce cluster create-kubeconfig --cluster-id ocid1.devopsdeployenvironment.oc1.mx-queretaro-1.amaaaaaapsxhejqa3uwqn7qw5jmg4vcc3vaimkk5qdz4bun6rq3i6c2ned7a --file $HOME/.kube/config --region queretaro --token-version 2.0.0
      export KUBECONFIG=$HOME/.kube/config

  - type: Command
    name: Undeploy
    command: |
      export PATH=$PATH:~/.local/bin
      kubectl -n mtdrworkshop delete deployment springboot-deployment
      kubectl -n mtdrworkshop delete service
